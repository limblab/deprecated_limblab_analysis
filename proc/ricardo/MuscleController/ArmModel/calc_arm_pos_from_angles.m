function [position] = calc_arm_pos_from_angles (init_params, q, LeftArm)

if nargin == 2
    LeftArm = 0;
end
% For this function, the units of angles MUST be in Radians!  The length
% measurements are in meters and the output of positions are in meters.
% 

Alpha = init_params.Alpha;
Pull = init_params.Pull;

position(1) = init_params.La(3)*sin(q(2)) + init_params.Lb(3)*sin(q(2)) + init_params.La(1)*cos(q(2))*cos(q(3)) + init_params.Lb(1)*cos(q(2))*cos(q(3)+q(4)) + init_params.Lc(2)*(sin(Alpha)*sin(q(2))-cos(Alpha)*cos(q(2))*sin(q(3)+q(4))) + init_params.Lc(3)*(cos(Alpha)*sin(q(2))*cos(q(5))+cos(q(2))*(cos(q(3))*(sin(q(5))*cos(q(4))+sin(Alpha)*sin(q(4))*cos(q(5)))-sin(q(3))*(sin(q(4))*sin(q(5))-sin(Alpha)*cos(q(4))*cos(q(5))))) + Pull(3)*(sin(q(2))*(sin(Alpha)*sin(Alpha-q(6))+cos(Alpha)*cos(q(5))*cos(Alpha-q(6)))-cos(q(2))*(sin(q(3))*(sin(q(4))*sin(q(5))*cos(Alpha-q(6))+cos(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))-cos(q(3))*(sin(q(5))*cos(q(4))*cos(Alpha-q(6))-sin(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6)))))) + Pull(1)*(sin(q(2))*(sin(Alpha)*sin(q(7))*cos(Alpha-q(6))-cos(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6))))-cos(q(2))*(sin(q(3))*(sin(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))+cos(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))-cos(q(3))*(cos(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))-sin(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6))))))) + Pull(2)*(sin(q(2))*(sin(Alpha)*cos(q(7))*cos(Alpha-q(6))+cos(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))-cos(q(2))*(cos(q(3))*(cos(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))+sin(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6)))))-sin(q(3))*(sin(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))-cos(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))))) - init_params.La(2)*sin(q(3))*cos(q(2)) - init_params.Lb(2)*cos(q(2))*sin(q(3)+q(4)) - init_params.Lc(1)*(cos(Alpha)*sin(q(2))*sin(q(5))+cos(q(2))*(sin(q(3))*(sin(q(4))*cos(q(5))+sin(Alpha)*sin(q(5))*cos(q(4)))-cos(q(3))*(cos(q(4))*cos(q(5))-sin(Alpha)*sin(q(4))*sin(q(5)))));

position(2) = init_params.La(1)*(sin(q(3))*cos(q(1))+sin(q(1))*sin(q(2))*cos(q(3))) + init_params.La(2)*(cos(q(1))*cos(q(3))-sin(q(1))*sin(q(2))*sin(q(3))) + init_params.Lb(1)*(cos(q(1))*sin(q(3)+q(4))+sin(q(1))*sin(q(2))*cos(q(3)+q(4))) + init_params.Lb(2)*(cos(q(1))*cos(q(3)+q(4))-sin(q(1))*sin(q(2))*sin(q(3)+q(4))) + init_params.Lc(2)*(cos(Alpha)*cos(q(1))*cos(q(3)+q(4))-sin(q(1))*(sin(Alpha)*cos(q(2))+cos(Alpha)*sin(q(2))*sin(q(3)+q(4)))) + init_params.Lc(1)*(cos(q(1))*(cos(q(3))*(sin(q(4))*cos(q(5))+sin(Alpha)*sin(q(5))*cos(q(4)))+sin(q(3))*(cos(q(4))*cos(q(5))-sin(Alpha)*sin(q(4))*sin(q(5))))+sin(q(1))*(cos(Alpha)*sin(q(5))*cos(q(2))-sin(q(2))*(sin(q(3))*(sin(q(4))*cos(q(5))+sin(Alpha)*sin(q(5))*cos(q(4)))-cos(q(3))*(cos(q(4))*cos(q(5))-sin(Alpha)*sin(q(4))*sin(q(5)))))) + init_params.Lc(3)*(cos(q(1))*(sin(q(3))*(sin(q(5))*cos(q(4))+sin(Alpha)*sin(q(4))*cos(q(5)))+cos(q(3))*(sin(q(4))*sin(q(5))-sin(Alpha)*cos(q(4))*cos(q(5))))-sin(q(1))*(cos(Alpha)*cos(q(2))*cos(q(5))-sin(q(2))*(cos(q(3))*(sin(q(5))*cos(q(4))+sin(Alpha)*sin(q(4))*cos(q(5)))-sin(q(3))*(sin(q(4))*sin(q(5))-sin(Alpha)*cos(q(4))*cos(q(5)))))) + Pull(3)*(cos(q(1))*(cos(q(3))*(sin(q(4))*sin(q(5))*cos(Alpha-q(6))+cos(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))+sin(q(3))*(sin(q(5))*cos(q(4))*cos(Alpha-q(6))-sin(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6)))))-sin(q(1))*(cos(q(2))*(sin(Alpha)*sin(Alpha-q(6))+cos(Alpha)*cos(q(5))*cos(Alpha-q(6)))+sin(q(2))*(sin(q(3))*(sin(q(4))*sin(q(5))*cos(Alpha-q(6))+cos(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))-cos(q(3))*(sin(q(5))*cos(q(4))*cos(Alpha-q(6))-sin(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))))) + Pull(1)*(cos(q(1))*(cos(q(3))*(sin(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))+cos(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))+sin(q(3))*(cos(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))-sin(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6))))))-sin(q(1))*(cos(q(2))*(sin(Alpha)*sin(q(7))*cos(Alpha-q(6))-cos(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6))))+sin(q(2))*(sin(q(3))*(sin(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))+cos(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))-cos(q(3))*(cos(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))-sin(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))))) - init_params.La(3)*sin(q(1))*cos(q(2)) - init_params.Lb(3)*sin(q(1))*cos(q(2)) - Pull(2)*(cos(q(1))*(sin(q(3))*(cos(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))+sin(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6)))))+cos(q(3))*(sin(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))-cos(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))))+sin(q(1))*(cos(q(2))*(sin(Alpha)*cos(q(7))*cos(Alpha-q(6))+cos(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))+sin(q(2))*(cos(q(3))*(cos(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))+sin(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6)))))-sin(q(3))*(sin(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))-cos(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))))));

position(3) = init_params.La(3)*cos(q(1))*cos(q(2)) + init_params.Lb(3)*cos(q(1))*cos(q(2)) + init_params.La(2)*(sin(q(1))*cos(q(3))+sin(q(2))*sin(q(3))*cos(q(1))) + init_params.La(1)*(sin(q(1))*sin(q(3))-sin(q(2))*cos(q(1))*cos(q(3))) + init_params.Lb(2)*(sin(q(1))*cos(q(3)+q(4))+sin(q(2))*cos(q(1))*sin(q(3)+q(4))) + init_params.Lb(1)*(sin(q(1))*sin(q(3)+q(4))-sin(q(2))*cos(q(1))*cos(q(3)+q(4))) + init_params.Lc(2)*(cos(Alpha)*sin(q(1))*cos(q(3)+q(4))+cos(q(1))*(sin(Alpha)*cos(q(2))+cos(Alpha)*sin(q(2))*sin(q(3)+q(4)))) + init_params.Lc(3)*(sin(q(1))*(sin(q(3))*(sin(q(5))*cos(q(4))+sin(Alpha)*sin(q(4))*cos(q(5)))+cos(q(3))*(sin(q(4))*sin(q(5))-sin(Alpha)*cos(q(4))*cos(q(5))))+cos(q(1))*(cos(Alpha)*cos(q(2))*cos(q(5))-sin(q(2))*(cos(q(3))*(sin(q(5))*cos(q(4))+sin(Alpha)*sin(q(4))*cos(q(5)))-sin(q(3))*(sin(q(4))*sin(q(5))-sin(Alpha)*cos(q(4))*cos(q(5)))))) + init_params.Lc(1)*(sin(q(1))*(cos(q(3))*(sin(q(4))*cos(q(5))+sin(Alpha)*sin(q(5))*cos(q(4)))+sin(q(3))*(cos(q(4))*cos(q(5))-sin(Alpha)*sin(q(4))*sin(q(5))))-cos(q(1))*(cos(Alpha)*sin(q(5))*cos(q(2))-sin(q(2))*(sin(q(3))*(sin(q(4))*cos(q(5))+sin(Alpha)*sin(q(5))*cos(q(4)))-cos(q(3))*(cos(q(4))*cos(q(5))-sin(Alpha)*sin(q(4))*sin(q(5)))))) + Pull(3)*(sin(q(1))*(cos(q(3))*(sin(q(4))*sin(q(5))*cos(Alpha-q(6))+cos(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))+sin(q(3))*(sin(q(5))*cos(q(4))*cos(Alpha-q(6))-sin(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6)))))+cos(q(1))*(cos(q(2))*(sin(Alpha)*sin(Alpha-q(6))+cos(Alpha)*cos(q(5))*cos(Alpha-q(6)))+sin(q(2))*(sin(q(3))*(sin(q(4))*sin(q(5))*cos(Alpha-q(6))+cos(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))-cos(q(3))*(sin(q(5))*cos(q(4))*cos(Alpha-q(6))-sin(q(4))*(cos(Alpha)*sin(Alpha-q(6))-sin(Alpha)*cos(q(5))*cos(Alpha-q(6))))))) + Pull(1)*(sin(q(1))*(cos(q(3))*(sin(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))+cos(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))+sin(q(3))*(cos(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))-sin(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6))))))+cos(q(1))*(cos(q(2))*(sin(Alpha)*sin(q(7))*cos(Alpha-q(6))-cos(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6))))+sin(q(2))*(sin(q(3))*(sin(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))+cos(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))-cos(q(3))*(cos(q(4))*(cos(q(5))*cos(q(7))-sin(q(5))*sin(q(7))*sin(Alpha-q(6)))-sin(q(4))*(cos(Alpha)*sin(q(7))*cos(Alpha-q(6))+sin(Alpha)*(sin(q(5))*cos(q(7))+sin(q(7))*cos(q(5))*sin(Alpha-q(6)))))))) - Pull(2)*(sin(q(1))*(sin(q(3))*(cos(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))+sin(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6)))))+cos(q(3))*(sin(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))-cos(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))))-cos(q(1))*(cos(q(2))*(sin(Alpha)*cos(q(7))*cos(Alpha-q(6))+cos(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))+sin(q(2))*(cos(q(3))*(cos(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))+sin(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6)))))-sin(q(3))*(sin(q(4))*(sin(q(7))*cos(q(5))+sin(q(5))*cos(q(7))*sin(Alpha-q(6)))-cos(q(4))*(cos(Alpha)*cos(q(7))*cos(Alpha-q(6))-sin(Alpha)*(sin(q(5))*sin(q(7))-cos(q(5))*cos(q(7))*sin(Alpha-q(6))))))));

% The left/right direction must be inverted for a left arm calculation.  
if LeftArm
    position(3) = -position(3);
end